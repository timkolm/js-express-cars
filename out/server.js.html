<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: server.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: server.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const express = require("express");

const app = express();
const port = 1337;

// Tell express to use EJS to render html
app.set("view engine", "ejs");

// needed to let express know how to interpret the data sent in the body (when using POST)
app.use(express.urlencoded({ extended: true }));

// get the movies/series map from the "DB" file
// Only necessary if we do not declare the variable in this file
const msdb = require("./msdb");
let ms = msdb.msDB;

/*
 * ROUTES
 */

app.get("/", function (req, res) {
    res.render(__dirname + "/public/index", {errors: [], element: {}});
});


app.get("/getAll", function (req, res) {
    res.render("pages/getall", { cars: ms["cars"] });
});

app.post("/save", function (req, res) {
    let msToAdd = createElement(req.body);
    validation = validate(msToAdd);

    if (validation.success === true) {
        save(msToAdd);
        res.send("Added!");
    } else {
        res.render(__dirname + "/public/index", { errors: validation.errors, element: msToAdd});
    }
});

app.get("/delete", function (req, res) {
    let id = Number(req.query["id"]);
    deleteRecord(id);
    res.send("Deleted!");
});

app.get("/edit", function (req, res) {
    let id = Number(req.query["id"]);
    element = findRecord(id);
    if (element !== 'undefined') {
        res.render(__dirname + "/public/index", { errors: [], element: element, index: id});
    }
    res.send("Car not found!");
});

app.post("/update", function (req, res) {
    let msToAdd = createElement(req.body);
    validation = validate(msToAdd);
    if (validation.success === true &amp;&amp; req.body["id"]) {
        const id = Number(req.body["id"]);
        const found = findRecord(id);

        if (typeof found === 'undefined') {
            res.send("Car not found!");
        } else {
            update(id, msToAdd);
            res.send("Updated!");
        }

    } else {
        res.render(__dirname + "/public/index", { errors: validation.errors, element: msToAdd, index: req.body["id"]});
    }

});

/*
 * FUNCTIONS
 */

// TESTABLE :)
/**
 * Returns an object with validation success and/or errors
 *
 * @param {Object} input
 * @returns {Object} {success: true|false, errors: []|null}
 */
function validate(input)
{
    let success = true;
    let errors = [];

    if (input.Maker === undefined || input.Maker.length === 0 || input.Maker.length > 20) {
        errors.push('Maker is entered incorrectly');
    }
    if (input.Genmodel === undefined || input.Genmodel.length === 0 || input.Genmodel.length > 20) {
        errors.push('Model is entered incorrectly');
    }
    if (
        input.Adv_year === undefined
        || input.Adv_year.length === 0
        || input.Adv_year &lt; 1900
        || input.Adv_year > new Date().getFullYear()
    ) {
        errors.push('Year is entered incorrectly');
    }
    if (input.Color === undefined || input.Color.length === 0 || input.Color.length > 20) {
        errors.push('Color is entered incorrectly');
    }
    if (input.Runned_Miles === undefined
        || input.Runned_Miles.length === 0
        || input.Runned_Miles &lt; 0
        || input.Runned_Miles > 1000000
    ) {
        errors.push('Mileage is entered incorrectly');
    }
    if (input.Price === undefined || input.Price.length === 0 || input.Price == 0) {
        errors.push('Price is entered incorrectly');
    }
    if (errors.length > 0) {
        success = false;
    }

    return {success: success, errors: errors};
}

/**
 * Transforms input values to an object ready to add to the cars array
 *
 * @param {Object} body
 * @returns {Object}
 */
function createElement(body)
{
    let maker = body["maker"];
    let model = body["model"];
    let year = Number(body["year"]);
    let color = body["color"];
    let mileage = Number(body["mileage"]);
    let price = Number(body["price"]);

    return {
        "Maker": maker,
        "Genmodel": model,
        "Adv_year": year,
        "Color": color,
        "Runned_Miles": mileage,
        "Price": price
    };
}

/**
 * Finds a record in the array of cars
 *
 * @param {int} id
 * @returns {Object|undefined}
 */
function findRecord(id)
{
    return ms["cars"].find(function (e, index) {
        if (index === id) {
            return e;
        }
    });
}

/**
 * Deletes a record from the array of cars
 *
 * @param {int} id
 * @returns {void}
 */
function deleteRecord(id) {
    ms['cars'] = ms['cars'].filter(function (element, index) {
        if (id === index) {
            return false;
        }
        return true;
    });
}

/**
 * Saves a record into the array of cars
 *
 * @param {Object} record
 * @returns {void}
 */
function save(record)
{
    ms["cars"].push(record);
}

/**
 * Updates a record in the array of cars
 *
 * @param {int} id
 * @param {Object} record
 * @returns {void}
 */
function update(id, record) {
    ms["cars"][id] = record;
}

if (process.argv.length >= 3 &amp;&amp; process.argv[2] === "start") {
    app.listen(port, function () {
        console.log("Server started!");
    });
} else {
    console.log('Please run "node server.js start" to start the server');
}

module.exports = {
    validate,
    createElement,
    findRecord,
    deleteRecord,
    save,
    update,
    ms
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#createElement">createElement</a></li><li><a href="global.html#deleteRecord">deleteRecord</a></li><li><a href="global.html#findRecord">findRecord</a></li><li><a href="global.html#save">save</a></li><li><a href="global.html#update">update</a></li><li><a href="global.html#validate">validate</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Mon Dec 27 2021 18:38:49 GMT+0100 (Central European Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
